---
layout: post
math: true
title: "Life is a hand of cards"
categories: math
tags: [chit-chat, probability]
---

人生一手牌

过年的时候，和爸爸、小朋友，爷孙三代一起打争上游，三个人一副牌，爷爷赢得多。

我不太记得具体的输赢局数，只记得抓到了两次炸弹。抓到炸弹，在感觉上是一件很奇妙的事情，每一个花色里的同一张牌，正好在手上集齐。

结束以后让小朋友尝试计算抓到炸弹的概率，也问了豆包和DeepSeek，都不太满意，自己来求解一下。

比如，在4张A里面，玩家抓到4张A可能出现的情况只有一种：$$ C_{4}^{4} $$

除了4张A以外，玩家可能抓到4张2、4张3，共有13种可能性：$$ \times 13 C_{4}^{4} $$

因为每人抓18张，总数为54张，因此需要在剩下的50张牌里，分别14张给玩家，组合的总数是： $$ C_{50}^{14} $$

总的可能性是，在54张牌里随机分配18张： $$ C_{54}^{18} $$

因此，粗略的算法是：

$$ P_{\text{至少一个}} \approx \frac {C_{4}^{4} \times 13 C_{50}^{14}} {C_{54}^{18}} $$

计算的数字很大，放到 desmos 上面，友好的结果秒出： 12.57%

之所以是粗略算法，因为上面的算法存在重复统计的情况：

比如，按照先前的思路，分不同的情况进行加总：

情况1： 给玩家分配4张A，然后在剩下的50张里面，给玩家分配14张

情况2： 给玩家分配4张2，然后在剩下的50张里面，给玩家分配14张

...

情况13：给玩家分配4张K，然后在剩下的50张里面，给玩家分配14张

所有抓到炸弹的可能组合数是上面的13种情况之和，在情况1剩余分配的14张里面，也有可能包含了4张2，也就是玩家抓到了两副炸弹，在情况2里面，也可能还有4张A。因此上述的算法存在重复统计。个人感觉上重复统计的情况应该挺少的，因为你可以回忆一下，在一个牌局里面，甩出两副及以上的炸弹的情况常不常见。

本着严谨的态度，需要用上容斥原理：

组合情况 = \sum_{k=0}^{max}{(-1)^k} \binom{12}{k} \binom{54-4-4k}{18-4-4k} 

通过交替加减来排除多个炸弹被玩家抓到从而被重复统计的情况，即：

$$ P_炸弹概率 = 13\cdot\frac{\left(\operatorname{nCr}\left(50,14\right)-12\cdot\operatorname{nCr}\left(46,10\right)+66\cdot\operatorname{nCr}\left(42,6\right)-220\cdot\operatorname{nCr}\left(38,2\right)\right)}{\operatorname{nCr}\left(54,18\right)} $$

最后的答案是 11.93%

大于10%的概率，有点出乎意料。写个python代码，运行了1亿次，模拟一下结果：

```python

import random
from collections import Counter

T = 100_000_000  # Target loops
counts = [0, 0, 0, 0, 0, 0]
valid_trials = 0  # 确保运行满目标次数, 严谨一些

random.seed()
while valid_trials < T:
    # 抽18张牌
    hand = random.sample(range(54), 18)

    # 统计频数
    num = Counter(0 if a < 2 else (a - 2) // 4 + 1 for a in hand)

    # 0的位置留给大小王，出现3张以上大小王或者5张以上其它花色牌应该排除
    if num[0] > 2 or any(count > 4 for count in num.values()):
        continue

    count_fours = sum(1 for key, count in num.items() if 1 <= key <= 13 and count == 4)
    counts[count_fours] += 1
    valid_trials += 1

scenarios = [
    "没有炸弹: {}",
    "1 副炸弹: {}",
    "2 副炸弹: {}",
    "3 副炸弹: {}",
    "4 副炸弹: {}",
    "5 副炸弹: {}"
]
for i, scenario in enumerate(scenarios):
    print(scenario.format(counts[i]))

```

|炸弹副数|出现次数|
|----|----|
|没有炸弹|87743954|
|1 副炸弹|11930164|
|2 副炸弹|324313|
|3 副炸弹|1569|
|4 副炸弹|0|
|5 副炸弹|0|


